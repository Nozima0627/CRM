generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
}

enum CourseLevel {
    beginner
    intermediate
    advanced
}

enum Role {
    SUPERADMIN
    ADMIN
    TEACHER
    STUDENT
}

enum StudentStatus {
    active
    inactive
    freeze
    graduated
}

enum WeekDay {
    MONDAY
    TUESDAY
    WEDNESDAY
    THURSDAY
    FRIDAY
    SATURDAY
    SUNDAY
}

enum Status {
    active
    inactive
    freeze
}

enum GroupStatus {
    planned
    active
    completed
}

model User {
    id              Int              @id @default(autoincrement())
    first_name      String
    last_name       String
    password        String
    role            Role
    phone           String           @unique
    email           String           @unique
    address         String
    photo           String?
    status          Status           @default(active)
    created_at      DateTime         @default(now())
    update_at       DateTime         @default(now())
    lessons         Lesson[]
    attendances     Attendance[]
    homework        Homework[]
    homeworkResults HomeworkResult[]
}

model Student {
    id                     Int                     @id @default(autoincrement())
    first_name             String
    last_name              String
    password               String
    phone                  String                  @unique
    email                  String                  @unique
    birth_date             DateTime
    address                String
    photo                  String?
    status                 StudentStatus           @default(active)
    created_at             DateTime                @default(now())
    update_at              DateTime                @default(now())
    studentGroups          StudentGroup[]
    attendances            Attendance[]
    homeworkAnswerStudents HomeworkAnswerStudent[]
}

model Teacher {
    id              Int              @id @default(autoincrement())
    first_name      String
    last_name       String
    password        String
    phone           String           @unique
    email           String           @unique
    address         String
    photo           String?
    status          Status           @default(active)
    created_at      DateTime         @default(now())
    update_at       DateTime         @default(now())
    groups          Group[]
    lessons         Lesson[]
    attendances     Attendance[]
    homework        Homework[]
    homeworkResults HomeworkResult[]
}

model Course {
    id             Int         @id @default(autoincrement())
    name           String      @unique
    description    String?
    price          Decimal
    duration_month Int
    duration_hours Int
    level          CourseLevel
    status         Status      @default(active)
    created_at     DateTime    @default(now())
    update_at      DateTime    @default(now())

    groups Group[]
}

model Room {
    id         Int      @id @default(autoincrement())
    name       String   @unique
    status     Status   @default(active)
    created_at DateTime @default(now())
    update_at  DateTime @default(now())
    groups     Group[]
}

model Group {
    id          Int         @id @default(autoincrement())
    name        String      @unique
    description String?
    course_id   Int
    teacher_id  Int
    room_id     Int
    start_date  DateTime
    week_day    WeekDay[]
    start_time  String
    max_student Int
    status      GroupStatus @default(active)
    created_at  DateTime    @default(now())
    update_at   DateTime    @default(now())

    courses       Course         @relation(fields: [course_id], references: [id])
    teachers      Teacher        @relation(fields: [teacher_id], references: [id])
    rooms         Room           @relation(fields: [room_id], references: [id])
    studentGroups StudentGroup[]
    lessons       Lesson[]
    homework      Homework[]
}

model StudentGroup {
    id         Int      @id @default(autoincrement())
    student_id Int
    group_id   Int
    status     Status   @default(active)
    created_at DateTime @default(now())
    update_at  DateTime @default(now())

    students Student @relation(fields: [student_id], references: [id])
    groups   Group   @relation(fields: [group_id], references: [id])

    @@unique([student_id, group_id])
}

model Lesson {
    id          Int      @id @default(autoincrement())
    group_id    Int
    teacher_id  Int?
    user_id     Int?
    theme       String
    description String?
    status      Status   @default(active)
    created_at  DateTime @default(now())
    update_at   DateTime @default(now())

    groups      Group        @relation(fields: [group_id], references: [id])
    teachers    Teacher?     @relation(fields: [teacher_id], references: [id])
    users       User?        @relation(fields: [user_id], references: [id])
    attendances Attendance[]
    homework    Homework[]
}

model Attendance {
    id         Int      @id @default(autoincrement())
    teacher_id Int?
    user_id    Int?
    lesson_id  Int
    student_id Int
    isPresent  Boolean
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    teachers Teacher? @relation(fields: [teacher_id], references: [id])
    users    User?    @relation(fields: [user_id], references: [id])
    lessons  Lesson   @relation(fields: [lesson_id], references: [id])
    students Student  @relation(fields: [student_id], references: [id])
}

model Homework {
    id         Int      @id @default(autoincrement())
    teacher_id Int?
    user_id    Int?
    lesson_id  Int
    group_id   Int
    title      String
    file       String?
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    teachers               Teacher?                @relation(fields: [teacher_id], references: [id])
    users                  User?                   @relation(fields: [user_id], references: [id])
    lessons                Lesson                  @relation(fields: [lesson_id], references: [id])
    groups                 Group                   @relation(fields: [group_id], references: [id])
    homeworkAnswerStudents HomeworkAnswerStudent[]
}

model HomeworkAnswerStudent {
    id          Int     @id @default(autoincrement())
    student_id  Int
    homework_id Int
    title       String
    file        String?

    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    students        Student          @relation(fields: [student_id], references: [id])
    homework        Homework         @relation(fields: [homework_id], references: [id])
    homeworkResults HomeworkResult[]
}

model HomeworkResult {
    id                 Int      @id @default(autoincrement())
    homework_answer_id Int
    teacher_id         Int?
    user_id            Int?
    grade              Int
    title              String
    status             Boolean
    created_at         DateTime @default(now())
    updated_at         DateTime @updatedAt

    teachers              Teacher?              @relation(fields: [teacher_id], references: [id])
    users                 User?                 @relation(fields: [user_id], references: [id])
    homeworkAnswerStudent HomeworkAnswerStudent @relation(fields: [homework_answer_id], references: [id])
}


